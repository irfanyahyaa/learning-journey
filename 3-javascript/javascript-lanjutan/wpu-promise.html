<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Promise</title>
  </head>
  <body>
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>
    <script>
      // 1. ajax jquery

      // $.ajax({
      //   url: "http://www.omdbapi.com/?apikey=287bdf7e&s=avengers",
      //   success: (movies) => console.log(movies),
      // });

      // -----------------------------------------------------------------------------------------------------
      // 2. ajax vanilla js

      // const xhr = new XMLHttpRequest();
      // xhr.onreadystatechange = function () {
      //   if (xhr.status === 200) {
      //     if (xhr.readyState === 4) {
      //       console.log(JSON.parse(xhr.response));
      //     }
      //   } else {
      //     console.log(xhr.responseText);
      //   }
      // };

      // xhr.open("get", "http://www.omdbapi.com/?apikey=287bdf7e&s=avengers");
      // xhr.send();

      // -----------------------------------------------------------------------------------------------------
      // 3. fetch js

      // const movies = fetch(
      //   "http://www.omdbapi.com/?apikey=287bdf7e&s=avengers"
      // );

      // console.log(movies); // promise

      // movies = fetch("http://www.omdbapi.com/?apikey=287bdf7e&s=avengers")
      //   .then((res) => res.json())
      //   .then((res) => console.log(res)); // array

      // -----------------------------------------------------------------------------------------------------
      // 4. promise

      // object yang merepresentasikan keberhasilan / kegagalan sebuah event async di masa yang akan datang
      // states (fulfilled / rejected / pending)
      // callback (resolve / reject / finally)
      // action (then / catch)

      // contoh

      // let ditepati = false;

      // const janji1 = new Promise((resolve, reject) => {
      //   if (ditepati) {
      //     resolve("Janji telah ditepati!");
      //   } else {
      //     reject("Ingkar janji.");
      //   }
      // });

      // janji1
      //   .then((res) => console.log(`OK : ${res}`))
      //   .catch((res) => console.log(`NOT OK : ${res}`))

      // -----------------------------------------------------------------------------------------------------
      // 5. contoh

      // let ditepati = true;

      // const janji2 = new Promise((resolve, reject) => {
      //   if (ditepati) {
      //     setTimeout(() => {
      //       resolve("Ditepati setelah beberapa waktu!");
      //     }, 2000);
      //   } else {
      //     setTimeout(() => {
      //       reject("Tidak ditepati setelah beberapa waktu!");
      //     }, 2000);
      //   }
      // });

      // console.log("mulai");
      // // console.log(janji2.then(() => console.log(janji2))); // pending visible
      // janji2
      //   .finally(() => console.log("Selesai menunggu!"))
      //   .then((res) => console.log(`OK : ${res}`))
      //   .catch((res) => console.log(`NOT OK : ${res}`)); // pending invisible
      // console.log("selesai");

      // -----------------------------------------------------------------------------------------------------
      // 6. Promise.all()

      const film = new Promise((resolve) => {
        setTimeout(() => {
          resolve([
            {
              judul: "Avengers",
              sutradara: "Irfan Yahya",
              pemeran: "Afif, Husna",
            },
          ]);
        }, 1000);
      });

      const cuaca = new Promise((resolve) => {
        setTimeout(() => {
          resolve([
            {
              kota: "Bogor",
              temperatur: 26,
              kondisi: "Hujan",
            },
          ]);
        }, 500);
      });

      // film.then((res) => console.log(res));
      // cuaca.then((res) => console.log(res));

      // run all promise
      Promise.all([film, cuaca])
        // .then((res) => console.log(res))
        .then((res) => {
          const [film, cuaca] = res;
          console.log(film);
          console.log(cuaca);
        });
    </script>
  </body>
</html>
